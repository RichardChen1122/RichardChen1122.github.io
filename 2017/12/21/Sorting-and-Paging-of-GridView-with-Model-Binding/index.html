<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Sorting and Paging of GridView with Model Binding | Richard Chen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Recently we got a bug from customer said that GridView sorting is not work well with paging enabled when using Model Binding. The “bug” behavior is different from when using an ObjectDataSource to pop">
<meta property="og:type" content="article">
<meta property="og:title" content="Sorting and Paging of GridView with Model Binding">
<meta property="og:url" content="http://richardchen1122.github.io/2017/12/21/Sorting-and-Paging-of-GridView-with-Model-Binding/index.html">
<meta property="og:site_name" content="Richard Chen">
<meta property="og:description" content="Recently we got a bug from customer said that GridView sorting is not work well with paging enabled when using Model Binding. The “bug” behavior is different from when using an ObjectDataSource to pop">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/5123088-1865bcdc2495bf8c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-12-21T04:52:27.978Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sorting and Paging of GridView with Model Binding">
<meta name="twitter:description" content="Recently we got a bug from customer said that GridView sorting is not work well with paging enabled when using Model Binding. The “bug” behavior is different from when using an ObjectDataSource to pop">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/5123088-1865bcdc2495bf8c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
  
    <link rel="alternate" href="/atom.xml" title="Richard Chen" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Richard Chen</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://richardchen1122.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Sorting-and-Paging-of-GridView-with-Model-Binding" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/21/Sorting-and-Paging-of-GridView-with-Model-Binding/" class="article-date">
  <time datetime="2017-12-21T04:51:45.000Z" itemprop="datePublished">2017-12-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Sorting and Paging of GridView with Model Binding
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently we got a bug from customer said that GridView sorting is not work well with paging enabled when using Model Binding. The “bug” behavior is different from when using an ObjectDataSource to populate the GridView, so bug was reported. </p>
<p>Let us see the “bug” detail first:</p>
<p>Default.aspx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:GridView ID=&quot;userGridView&quot; runat=&quot;server&quot; AllowPaging=&quot;true&quot; AllowSorting=&quot;true&quot; AutoGenerateColumns=&quot;false&quot;</span><br><span class="line">    DataKeyNames=&quot;Id&quot; SelectMethod=&quot;userGridView_GetData&quot;&gt;</span><br><span class="line">    &lt;Columns&gt;</span><br><span class="line">        &lt;asp:BoundField DataField=&quot;LastName&quot; HeaderText=&quot;Last Name&quot; SortExpression=&quot;LastName&quot; /&gt;</span><br><span class="line">        &lt;asp:BoundField DataField=&quot;FirstName&quot; HeaderText=&quot;First Name&quot; SortExpression=&quot;FirstName&quot; /&gt;</span><br><span class="line">    &lt;/Columns&gt;</span><br><span class="line">&lt;/asp:GridView&gt;</span><br></pre></td></tr></table></figure></p>
<p>Default.aspx.cs<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">namespace GridViewSort</span><br><span class="line">&#123;</span><br><span class="line">    public class User</span><br><span class="line">    &#123;</span><br><span class="line">        public int Id &#123; get; set; &#125;</span><br><span class="line">        public string FirstName &#123; get; set; &#125;</span><br><span class="line">        public string LastName &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public partial class _Default : Page</span><br><span class="line">    &#123;</span><br><span class="line">        protected void Page_Load(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IEnumerable&lt;User&gt; GetUsers()</span><br><span class="line">        &#123;</span><br><span class="line">            User[] users = new[]</span><br><span class="line">            &#123;</span><br><span class="line">               new User &#123; Id = 1, FirstName = &quot;A&quot;, LastName = &quot;One&quot; &#125;,</span><br><span class="line">               new User &#123; Id = 2, FirstName = &quot;B&quot;, LastName = &quot;Two&quot; &#125;,</span><br><span class="line">               new User &#123; Id = 3, FirstName = &quot;C&quot;, LastName = &quot;Three&quot; &#125;,</span><br><span class="line">               new User &#123; Id = 4, FirstName = &quot;D&quot;, LastName = &quot;Four&quot; &#125;,</span><br><span class="line">               new User &#123; Id = 5, FirstName = &quot;E&quot;, LastName = &quot;Five&quot; &#125;,</span><br><span class="line">               new User &#123; Id = 6, FirstName = &quot;F&quot;, LastName = &quot;Six&quot; &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            return users.OrderByDescending(u =&gt; u.LastName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public IQueryable&lt;User&gt; userGridView_GetData()</span><br><span class="line">        &#123;</span><br><span class="line">            var users = GetUsers();</span><br><span class="line"></span><br><span class="line">            return users.AsQueryable();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>The <figure class="highlight plain"><figcaption><span>returns the collection ordered by User LastName. When  set```AllowPaging </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">![image.png](http://upload-images.jianshu.io/upload_images/5123088-7281be8b9ce4ebad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line"></span><br><span class="line">However, when set ```AllowPaging =&quot;true&quot;```, behavior changes, GridView rows not sorted by LastName anymore. like this: </span><br><span class="line">![image.png](http://upload-images.jianshu.io/upload_images/5123088-cfcf81b8f4b42a07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br><span class="line"></span><br><span class="line">Then the &quot;bug&quot; was report, ```AllowPaging =&quot;true&quot;``` leads the behavior change. Customer cannot get an ordered GridView in the page initialize.</span><br><span class="line"></span><br><span class="line">After our investigation, this is not a bug actually, ASP.NET model binding already provide a way to handle such scenario. The solution is update the ```SelectMethod``` to</span><br><span class="line">```public IQueryable&lt;User&gt; userGridView_GetData(int maximumRows, int startRowIndex, out int totalRowCount, string sortByExpression)</span><br></pre></td></tr></table></figure></p>
<p>instead of<br><figure class="highlight plain"><figcaption><span>IQueryable<user> userGridView_GetData()```</user></span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">After some small change, the behavior must meet the customer&apos;s expected:</span><br></pre></td></tr></table></figure></p>
<p>public IQueryable<user> userGridView_GetData(int maximumRows, int startRowIndex, out int totalRowCount, string sortByExpression)<br>        {<br>            var users = GetUsers();<br>            totalRowCount = users.Count();<br>            return users.Skip(startRowIndex).Take(maximumRows).AsQueryable();<br>        }<br>```<br>Then the result will be<br><img src="http://upload-images.jianshu.io/upload_images/5123088-1865bcdc2495bf8c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></user></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://richardchen1122.github.io/2017/12/21/Sorting-and-Paging-of-GridView-with-Model-Binding/" data-id="cjbg0hobl00011syss1q4r511" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2017/12/21/Asp-net-Core-Middleware/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Asp.net Core Middleware</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/12/21/Sorting-and-Paging-of-GridView-with-Model-Binding/">Sorting and Paging of GridView with Model Binding</a>
          </li>
        
          <li>
            <a href="/2017/12/21/Asp-net-Core-Middleware/">Asp.net Core Middleware</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Richard Chen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>